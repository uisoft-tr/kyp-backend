import{r as m,I as R,h as P,aD as k,aF as F,aE as O,aB as e,aI as N,b0 as b,bb as Y,b2 as V,b9 as q,ba as w,bh as A}from"./index-iICuzTeq.js";import{c as G,F as H,R as K,D as C,b as J,e as v,C as Q,S}from"./App-Dj5y_YEV.js";import{ap as I,B as g,H as M,aj as u,ak as U,al as j,am as D}from"./AuthGate-BbxU_GZy.js";import{R as W,e as X}from"./exportExcel-BWEvanXS.js";var Z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},ee=function(n,r){return m.createElement(R,P({},n,{ref:r,icon:Z}))},ae=m.forwardRef(ee);const te=({makinaId:s,collapsed:n})=>{const[r,o]=m.useState(!1),{datas:{results:i,count:f},page:h,pageSize:l,filters:c}=k(a=>a.data),p=F(),y=O(),t=I(),d=()=>{X({endpoint:"/makine_takip/makina_calistigi_yer/",filters:{makina_id:s,export:"excel",...c},filename:"calisilanyerler.xlsx"})},z=(a,x)=>{p(V(a)),p(q(x))},_=async()=>{o(!0);try{const a=await b.get({entity:`/makine_takip/makina_calistigi_yer/?makina_id=${s}`,params:{page:h,pageSize:l}});p(Y(a))}catch(a){console.error("Veri alınırken bir hata oluştu",a)}finally{o(!1)}};m.useEffect(()=>{s&&_()},[s,h,l]);const T=a=>{console.log(a,"record"),y(`/makine-takip/edit/${a}`)},{deletingId:E,handleDelete:$}=G("makine_takip",null,a=>{const x=i.find(L=>L.id===a);return x?`"${x.makine_no}" numaralı makinenin çalışmasını silmek istediğinize emin misiniz?`:"Bu öğeyi silmek istediğinize emin misiniz?"},_),B=[{title:"Çalıştığı Yer",dataIndex:"calistigi_yer",key:"calistigi_yer",width:150},{title:"İş Tanımı",dataIndex:"is_tanimi_ad",key:"is_tanimi_ad",width:150},{title:"Başlangıç Tarihi",dataIndex:"ise_baslama",key:"ise_baslama",width:150,render:a=>new Date(a).toLocaleDateString()},{title:"Bitiş Tarihi",dataIndex:"ise_bitis",key:"ise_bitis",width:150,render:a=>a?new Date(a).toLocaleDateString():"Devam ediyor"},{title:"Çalışma Süresi (Gün)",dataIndex:"calisma_suresi",key:"calisma_suresi",render:a=>a||"-",width:150},{title:"",key:"actions",fixed:"right",width:70,render:(a,x)=>e.jsxs("div",{className:`flex justify-center !p-0 ${t?"":"gap-2"}`,children:[e.jsx(M,{title:"Düzenle",children:e.jsx(g,{className:`${t?"text-[14px]":"text-[18px]"}`,type:"text",icon:e.jsx(W,{}),onClick:()=>T(x.id)})}),e.jsx(M,{title:"Sil",children:e.jsx(g,{danger:!0,className:`${t?"text-[14px]":"text-[18px]"}`,type:"text",icon:e.jsx(K,{}),loading:E===x.id,onClick:()=>$(x.id)})})]})}];return e.jsx("div",{children:r?e.jsx(N,{}):(i==null?void 0:i.length)>0?e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full overflow-auto",children:e.jsx(H,{dataSource:i,columns:B,rowKey:"id",pagination:{responsive:!0,current:h,pageSize:l,total:f,onChange:z,showTotal:a=>t?"":e.jsxs("div",{children:["Toplam ",e.jsx("span",{className:"font-bold",children:a})," veriden"," ",e.jsx("span",{className:"font-bold",children:i.length})," ","gösteriliyor."]})},scroll:n?{y:400,x:"max-content"}:{x:"max-content",y:"max-content"},footer:()=>(i==null?void 0:i.length)>0?e.jsx(g,{type:"primary",onClick:d,style:{position:"absolute",bottom:0,left:0,zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.15)",borderRadius:6},className:` ${t?"text-[10px]":"text-[14px]"}`,children:"Excel'e Aktar"}):null})})}):e.jsxs("div",{className:"text-center p-6 h-96 flex flex-col justify-center items-center",children:[e.jsx(ae,{style:{fontSize:"32px",color:"#999"}}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Bu makineye ait herhangi bir çalışma kaydı bulunmamaktadır."})]})})},ie=({onFilterChange:s})=>{const[n]=u.useForm(),r=o=>{const i={...o,ise_baslama:o.ise_baslama?v(o.ise_baslama).format("YYYY-MM-DD"):void 0,ise_bitis:o.ise_bitis?v(o.ise_bitis).format("YYYY-MM-DD"):void 0};s(i)};return e.jsxs(u,{form:n,layout:"vertical",onFinish:r,className:"w-full mx-auto px-5",children:[e.jsxs(U,{gutter:[16,16],children:[e.jsx(j,{xs:24,sm:12,md:12,lg:6,children:e.jsx(u.Item,{label:"Çalıştığı Yer",name:"calistigi_yer",children:e.jsx(D,{})})}),e.jsx(j,{xs:24,sm:12,md:12,lg:6,children:e.jsx(u.Item,{label:"İş Tanımı",name:"is_tanimi",children:e.jsx(D,{})})}),e.jsx(j,{xs:24,sm:12,md:12,lg:6,children:e.jsx(u.Item,{label:"Başlangıç Tarihi",name:"ise_baslama",children:e.jsx(C,{format:"DD-MM-YYYY",className:"w-full"})})}),e.jsx(j,{xs:24,sm:12,md:12,lg:6,children:e.jsx(u.Item,{label:"Bitiş Tarihi",name:"ise_bitis",children:e.jsx(C,{format:"YYYY-MM-DD",className:"w-full"})})})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs(J,{children:[e.jsx(g,{type:"primary",htmlType:"submit",children:"Filtrele"}),e.jsx(g,{onClick:()=>{n.resetFields(),s({})},children:"Temizle"})]})})]})},se=({onCollapseChange:s,makinaId:n})=>{const r=F(),{page:o,pageSize:i,filters:f}=k(l=>l.data),h=async l=>{try{r(w(!0)),r(A(l)),console.log(l,"filter");const c=await b.filter({entity:"/makine_takip/makina_calistigi_yer/",values:{makina_id:n,...l,page:o,page_size:i}});console.log(c,"filterverisi"),r(Y(c))}catch(c){console.error("Filtreleme işlemi sırasında bir hata oluştu:",c)}finally{r(w(!1))}};return e.jsx(Q,{onChange:l=>s(l.length>0),items:[{key:"1",label:e.jsx("span",{className:"text-white font-bold",children:"Filtrele"}),children:e.jsx(ie,{onFilterChange:h})}],className:"bg-[#0F6769]"})},ce=()=>{const[s,n]=m.useState(null),[r,o]=m.useState([]),[i,f]=m.useState(!0),[h,l]=m.useState(!1),c=I(),p=k(t=>t.data.data);m.useEffect(()=>{(async()=>{try{const d=await b.get({entity:"/makine/?no_pagination=true"});o(d),p?n(p):d.length>0&&n(d[0].id)}catch(d){console.error("Makine listesi alınırken hata oluştu",d)}finally{f(!1)}})()},[p]);const y=t=>{n(t)};return e.jsx("div",{className:"w-full",children:i?e.jsx(N,{}):e.jsxs("div",{className:`flex flex-col  px-1 gap-2 w-full h-full ${c?"mt-5":""}`,children:[e.jsx(se,{makinaId:s,onCollapseChange:l}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(S,{style:{width:200},value:s,onChange:y,showSearch:!0,filterOption:(t,d)=>String(d.children).toLowerCase().includes(t.toLowerCase()),optionFilterProp:"children",children:r.map(t=>e.jsxs(S.Option,{value:t.id,children:[t.no," ",t.marka_ad]},t.id))}),e.jsx("p",{className:`text-[#0F6769] mb-0 ${c?"text-[8px] ":"text-[12px] "} `,children:"Seçilen makineye göre çalıştığı yerler aşağıda listelenecektir!"})]}),e.jsx(te,{makinaId:s,collapsed:h})]})})};export{ce as default};
