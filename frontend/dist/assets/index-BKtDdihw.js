import{r as d,aB as e,b0 as w,aF as I,aD as v,ba as C,bh as D,b2 as F,bb as O,b9 as $,bc as E,b4 as z,aI as B}from"./index-iICuzTeq.js";import{aj as u,ak as S,al as f,B as y,ap as T,H as N}from"./AuthGate-BbxU_GZy.js";import{T as L,S as o,b as Y,C as K,c as M,F as V,R as A,P as q}from"./App-Dj5y_YEV.js";import{R as H,e as G}from"./exportExcel-BWEvanXS.js";const J=({onFilterChange:m})=>{const[i]=u.useForm(),[p,s]=d.useState([]),[j,x]=d.useState([]),[l,t]=d.useState(null),h=a=>{m(a)};return d.useEffect(()=>{(async()=>{try{const n=await w.get({entity:"/iller"});s(n)}catch(n){console.error("İller verisi alınamadı:",n)}})()},[]),d.useEffect(()=>{(async()=>{if(l)try{const n=await w.get({entity:`/ilceler/?il_id=${l}`});x(n)}catch(n){console.error("İlçe verisi alınamadı:",n)}else x([])})()},[l]),e.jsxs(u,{form:i,layout:"vertical",onFinish:h,className:"w-full mx-auto px-5",children:[e.jsxs(S,{gutter:[16,16],children:[e.jsx(f,{xs:24,sm:12,md:8,children:e.jsx(u.Item,{label:"Bölge No",name:"bolge_no",children:e.jsx(L,{style:{width:"100%"}})})}),e.jsx(f,{xs:24,sm:12,md:8,children:e.jsx(u.Item,{label:"İl",name:"il",children:e.jsx(o,{value:l,onChange:a=>{t(a),i.setFieldsValue({ilce:null})},options:p==null?void 0:p.map(a=>({label:a.name,value:a.id}))})})}),e.jsx(f,{xs:24,sm:12,md:8,children:e.jsx(u.Item,{label:"İlçe",name:"ilce",children:e.jsx(o,{options:j.map(a=>({label:a.name,value:a.id})),disabled:!l})})})]}),e.jsxs(S,{gutter:[16,16],children:[e.jsx(f,{xs:24,sm:12,md:8,children:e.jsx(u.Item,{label:"İlk İnceleme Raporu",name:"ilk_inceleme_raporu",children:e.jsxs(o,{allowClear:!0,children:[e.jsx(o.Option,{value:"var",children:"Var"}),e.jsx(o.Option,{value:"yok",children:"Yok"})]})})}),e.jsx(f,{xs:24,sm:12,md:8,children:e.jsx(u.Item,{label:"Ön İnceleme Raporu",name:"on_inceleme_raporu",children:e.jsxs(o,{allowClear:!0,children:[e.jsx(o.Option,{value:"var",children:"Var"}),e.jsx(o.Option,{value:"yok",children:"Yok"})]})})}),e.jsx(f,{xs:24,sm:12,md:8,children:e.jsx(u.Item,{label:"Kamulaştırma Problemi",name:"kamulastirma_problemi",children:e.jsxs(o,{allowClear:!0,children:[e.jsx(o.Option,{value:"var",children:"Var"}),e.jsx(o.Option,{value:"yok",children:"Yok"})]})})})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs(Y,{children:[e.jsx(y,{type:"primary",htmlType:"submit",children:"Filtrele"}),e.jsx(y,{onClick:()=>{i.resetFields(),m({})},children:"Temizle"})]})})]})},Q=({onCollapseChange:m})=>{const i=I(),{page:p,pageSize:s,filters:j}=v(l=>l.data),x=async l=>{try{i(C(!0)),i(D(l)),i(F(1));const t=await w.filter({entity:"/planlamalar",values:{...l,page:1,page_size:s}});i(O(t))}catch(t){console.error("Filtreleme işlemi sırasında bir hata oluştu:",t)}finally{i(C(!1))}};return e.jsx(K,{onChange:l=>m(l.length>0),items:[{key:"1",label:e.jsx("span",{className:"text-white font-bold",children:"Filtrele"}),children:e.jsx(J,{onFilterChange:x})}],className:"bg-[#0F6769]"})},U=({setDrawerOpen:m,setIsEdit:i,collapsed:p})=>{const{datas:{results:s,count:j},page:x,pageSize:l,filters:t}=v(r=>r.data),h=I(),a=T(),n=()=>{G({endpoint:"/planlamalar/export-excel",filters:t,filename:"planlamalar.xlsx"})},k=(r,c)=>{h(F(r)),h($(c))},g=r=>{const c=s.find(_=>_.id===r);h(E(c)),i(!0),m(!0)},{deletingId:b,handleDelete:P}=M("/planlamalar",null,r=>{const c=s.find(_=>_.id===r);return c?`"${c.sira_no}" nolu planlamayı silmek istediğinize emin misiniz?`:"Bu öğeyi silmek istediğinize emin misiniz?"},()=>{h(z({page:1,pageSize:l,filters:t}))}),R=[{title:"Sıra No",dataIndex:"sira_no",key:"sira_no",width:85},{title:"Bölge No",dataIndex:"bolge_no",key:"bolge_no",width:95},{title:"İl",dataIndex:"il_adi",key:"il_adi",width:120},{title:"İlçe",dataIndex:"ilce_adi",key:"ilce_adi",width:120},{title:"Taşkın İşi Adı",dataIndex:"taskin_isi_adi",key:"taskin_isi_adi",width:250},{title:"İlk İnceleme",dataIndex:"ilk_inceleme_raporu",key:"ilk_inceleme_raporu",width:120},{title:"Ön İnceleme",dataIndex:"on_inceleme_raporu",key:"on_inceleme_raporu",width:120},{title:"Kamulaştırma",dataIndex:"kamulastirma_problemi",key:"kamulastirma_problemi",width:130},{title:"Yaklaşık Maliyet (TL)",dataIndex:"yaklasik_insaat_maliyeti",key:"yaklasik_insaat_maliyeti",width:180,render:r=>new Intl.NumberFormat("tr-TR",{minimumFractionDigits:0,maximumFractionDigits:0}).format(r)},{title:"Korunan Yerleşim",dataIndex:"korunan_yerlesim_yeri",key:"korunan_yerlesim_yeri",width:170},{title:"Açıklama",dataIndex:"aciklama",key:"aciklama",width:250},{title:"",key:"actions",fixed:"right",render:(r,c)=>e.jsxs("div",{className:`flex justify-center !p-0 ${a?"":"gap-2"}`,children:[e.jsx(N,{title:"Düzenle",children:e.jsx(y,{className:`${a?"text-[14px]":"text-[18px]"}`,type:"text",icon:e.jsx(H,{}),onClick:()=>g(c.id)})}),e.jsx(N,{title:"Sil",children:e.jsx(y,{danger:!0,className:`${a?"text-[14px]":"text-[18px]"}`,type:"text",icon:e.jsx(A,{}),loading:b===c.id,onClick:()=>P(c.id)})})]})}];return e.jsx(e.Fragment,{children:e.jsx(V,{dataSource:s,columns:R,rowKey:"id",pagination:{responsive:!0,current:x,pageSize:l,total:j,showLessItems:!1,onChange:k,showTotal:r=>a?"":e.jsxs(e.Fragment,{children:["Toplam ",e.jsx("span",{className:"font-bold",children:r})," planlamadan"," ",e.jsx("span",{className:"font-bold",children:s.length})," ","gösteriliyor."]})},scroll:p?{y:400,x:"max-content"}:{x:"max-content",y:"max-content"},footer:()=>(s==null?void 0:s.length)>0?e.jsx(y,{type:"primary",onClick:n,style:{position:"absolute",bottom:0,left:0,zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.15)",borderRadius:6},className:` ${a?"text-[10px]":"text-[14px]"}`,children:"Excel'e Aktar"}):null})})},ae=()=>{const[m,i]=d.useState(!1),[p,s]=d.useState(!1),[j,x]=d.useState(!1),l=T(),t=I(),{page:h,pageSize:a,filters:n,loading:k}=v(b=>b.data),g=()=>{s(!1),t(E(null)),x(!1)};return d.useEffect(()=>{t(z({page:h,pageSize:a,filters:n}))},[t,h,a,n]),d.useEffect(()=>()=>{t(D({})),t(F(1))},[t]),e.jsxs("div",{className:`flex flex-col  px-1 gap-2 w-full h-full ${l?"mt-5":""}`,children:[e.jsx(Q,{onCollapseChange:i}),e.jsx("div",{className:"flex-1 overflow-hidden",children:k?e.jsx(B,{}):e.jsx("div",{className:m?"overflow-auto":"w-full",children:e.jsx(U,{setIsEdit:x,setDrawerOpen:s,collapsed:m})})}),e.jsx(q,{open:p,onClose:g,isEdit:j})]})};export{ae as default};
